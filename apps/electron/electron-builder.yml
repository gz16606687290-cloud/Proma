# electron-builder 配置
# 文档: https://www.electron.build/configuration/configuration

appId: com.proma.app
productName: Proma
copyright: Copyright © 2024-2025 Proma

# 目录配置
directories:
  output: out
  buildResources: resources

# 压缩配置
compression: normal

# ASAR 打包配置（禁用 ASAR，避免 SDK symlink 路径越界问题）
asar: false

# 通用文件配置
files:
  - dist/**/*
  - package.json
  # 排除 workspace 包的 symlink（代码已被 esbuild/Vite 打包到 dist/ 中）
  - "!node_modules/@proma/**"
  # 排除所有平台的 ripgrep，会在平台特定配置中添加正确的版本
  - "!node_modules/@anthropic-ai/claude-agent-sdk/vendor/ripgrep/**/*"

# 通用额外资源：将 SDK 复制到 app/node_modules 中供运行时 require 解析
extraResources:
  - from: node_modules/@anthropic-ai/claude-agent-sdk
    to: app/node_modules/@anthropic-ai/claude-agent-sdk
    filter:
      - "**/*"
  # 默认 Skills 模板（首次启动时同步到 ~/.proma/default-skills/）
  - from: default-skills
    to: default-skills
    filter:
      - "**/*"

# ============================================
# macOS 配置
# ============================================
mac:
  category: public.app-category.developer-tools
  icon: resources/icon.icns
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: resources/entitlements.mac.plist
  entitlementsInherit: resources/entitlements.mac.plist
  target:
    - target: dmg
      arch:
        - arm64
        - x64
    - target: zip
      arch:
        - arm64
        - x64
  # macOS 额外资源
  extraResources:
    # Bun 二进制（download-bun.ts 使用 darwin-${arch} 命名）
    - from: "vendor/bun/darwin-${arch}"
      to: "vendor/bun"
      filter:
        - "**/*"
    # 根据架构选择正确的 ripgrep（实际位于 packages/core 的 node_modules 中）
    - from: "../../packages/core/node_modules/@anthropic-ai/claude-agent-sdk/vendor/ripgrep/${arch}-darwin"
      to: "vendor/ripgrep"
      filter:
        - "**/*"

# DMG 配置
dmg:
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: link
      path: /Applications
  window:
    width: 540
    height: 380

# ============================================
# Windows 配置
# ============================================
win:
  icon: resources/icon.ico
  target:
    - target: nsis
      arch:
        - x64
  # Windows 额外资源
  extraResources:
    # Bun 二进制
    - from: "vendor/bun/win32-${arch}"
      to: "vendor/bun"
      filter:
        - "**/*"
    - from: "../../packages/core/node_modules/@anthropic-ai/claude-agent-sdk/vendor/ripgrep/x64-win32"
      to: "vendor/ripgrep"
      filter:
        - "**/*"

# NSIS 安装程序配置
nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true

# ============================================
# Linux 配置
# ============================================
linux:
  icon: resources/icon.png
  category: Development
  target:
    - target: AppImage
      arch:
        - x64
        - arm64
    - target: deb
      arch:
        - x64
        - arm64
  # Linux 额外资源
  extraResources:
    # Bun 二进制
    - from: "vendor/bun/linux-${arch}"
      to: "vendor/bun"
      filter:
        - "**/*"
    - from: "../../packages/core/node_modules/@anthropic-ai/claude-agent-sdk/vendor/ripgrep/${arch}-linux"
      to: "vendor/ripgrep"
      filter:
        - "**/*"

# AppImage 配置
appImage:
  artifactName: "${productName}-${version}-${arch}.AppImage"

# Debian 包配置
deb:
  depends:
    - gconf2
    - gconf-service
    - libnotify4
    - libappindicator1
    - libxtst6
    - libnss3
    - git

# ============================================
# 发布配置
# ============================================
publish:
  provider: github
  owner: ErlichLiu
  repo: Proma
